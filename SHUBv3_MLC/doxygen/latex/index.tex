\chapter{Machine\+\_\+\+Learning\+\_\+\+Core\+\_\+\+STM32\+WL55/\+SHUBv3\+\_\+\+MLC}
\hypertarget{index}{}\label{index}\index{Machine\_Learning\_Core\_STM32WL55/SHUBv3\_MLC@{Machine\_Learning\_Core\_STM32WL55/SHUBv3\_MLC}}
Code documentation.


\begin{DoxyItemize}
\item Read\+Me
\end{DoxyItemize}

{\bfseries{Machine Learning Core with STM MEMS}}

{\bfseries{Sensor LSM6\+DSOX}}

Harris Koutsourelakis

V1.\+0

14 Sep 2022\hypertarget{index_autotoc_md23}{}\doxysection{\texorpdfstring{1 -\/ Application examples -\/ Introduction}{1 -\/ Application examples -\/ Introduction}}\label{index_autotoc_md23}
The {\itshape Application examples} section of the {\bfseries{Machine Learning Core}} repository contains examples of applications ready to be used on the ST MEMS devices, and are grouped by part number.

Each folder (related to a sensor part number) contains sub-\/folders with examples of {\bfseries{Machine Learning Core}} configurations. See a typical path below\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\(\backslash\)lsm6dsox\(\backslash\)Vibration\ monitoring\(\backslash\)}

\end{DoxyCode}


Each example sub-\/folder contains\+:


\begin{DoxyItemize}
\item A \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}{\ttfamily \doxylink{README_8md}{README.\+md}}\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} file, with information about the specific application example.
\item A \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}{\ttfamily .ucf}\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} file (Unico Configuration File), containing the device configuration generated by \href{https://www.st.com/en/embedded-software/unico-gui.html}{\texttt{ {\bfseries{Unico GUI}}}}. This file can be loaded in different software tools (\href{https://www.st.com/content/st_com/en/products/embedded-software/evaluation-tool-software/unico-gui.html}{\texttt{ Unico GUI}} , \href{https://www.st.com/content/st_com/en/products/embedded-software/evaluation-tool-software/unicleo-gui.html}{\texttt{ Unicleo GUI}} , \href{https://www.st.com/content/st_com/en/products/embedded-software/mems-and-sensors-software/inemo-engine-software-libraries/algobuilder.html}{\texttt{ Algo\+Builder GUI}}, etc...) in combination with different hardware tools (\href{https://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/mems-motion-sensor-eval-boards/steval-mki109v3.html}{\texttt{ STEVAL-\/\+MKI109\+V3}}, \href{https://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/mcu-mpu-eval-tools/stm32-mcu-mpu-eval-tools/stm32-nucleo-boards.html}{\texttt{ STM32 Nucleo}}, \href{https://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/mems-motion-sensor-eval-boards/steval-mksbox1v1.html}{\texttt{ Sensor\+Tile.\+box}}, etc...) provided by ST. The following section describes how to use the file using the different tools.
\item A \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}{\ttfamily .h}\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} file, containing the same information as the {\ttfamily .ucf} file, but in the format of a {\itshape C programming language header} (also this file is generated by {\itshape Unico GUI}). Examples of {\ttfamily .h} file integration in {\itshape C projects} are available at \href{http://www.st.com/content/st_com/en/products/embedded-software/mems-and-sensors-software/drivers-for-mems/c-driver-mems.html}{\texttt{ platform independent drivers repository}} for {\itshape STMicroelectronics} sensors.
\end{DoxyItemize}\hypertarget{index_autotoc_md24}{}\doxysection{\texorpdfstring{2. How to run the application examples}{2. How to run the application examples}}\label{index_autotoc_md24}
\hypertarget{index_autotoc_md25}{}\doxysubsection{\texorpdfstring{Run the example with {\itshape Professional MEMS tool} board and {\itshape Unico GUI}}{Run the example with {\itshape Professional MEMS tool} board and {\itshape Unico GUI}}}\label{index_autotoc_md25}


{\bfseries{Click to see/hide details }}\begin{adjustwidth}{1em}{0em}


\href{https://www.st.com/content/st_com/en/products/embedded-software/evaluation-tool-software/unico-gui.html}{\texttt{ Unico GUI}} is a software tool working with \href{https://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/mems-motion-sensor-eval-boards/steval-mki109v3.html}{\texttt{ STEVAL-\/\+MKI109\+V3}}, professional evaluation board for MEMS sensors, referenced as {\bfseries{Profi\+MEMS}} in ST docs.

To run the MLC application example in {\itshape Unico GUI}, the {\ttfamily .ucf} file has to be loaded as described in the following steps\+:


\begin{DoxyEnumerate}
\item Download the latest version of {\itshape Unico GUI} (if not already installed on your PC)
\item Plug the DIL24 adapter (e.\+g. \href{https://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/mems-motion-sensor-eval-boards/steval-mki197v1.html}{\texttt{ STEVAL-\/\+MKI197\+V1}}, depending on the example) to the {\itshape Profi\+MEMS} motherboard
\item Plug the {\itshape Profi\+MEMS} board to your PC through a USB-\/micro\+USB cable
\begin{DoxyItemize}
\item if necessary, upgrade the firmware of your board as described in the user manual \href{https://www.st.com/resource/en/user_manual/dm00331058-stevalmki109v3-professional-mems-tool-motherboard-for-mems-adapter-boards-stmicroelectronics.pdf}{\texttt{ UM2116}}
\end{DoxyItemize}
\item Run {\itshape Unico GUI} selecting the desired device (adapter board, e.\+g. {\itshape STEVAL-\/\+MKI197\+V1})
\item Go to the {\itshape Load/\+Save} tab, of the {\itshape Unico GUI} and load the {\itshape Unico} Configuration File ({\ttfamily .ucf})
\item Once the device has been configured, press {\itshape Start} and you can visualize MLC results in the {\itshape Data} tool of {\itshape Unico GUI}
\end{DoxyEnumerate}

\end{adjustwidth}
\hypertarget{index_autotoc_md26}{}\doxysubsection{\texorpdfstring{Run the example with {\itshape STM32 Nucleo} board and {\itshape Unicleo GUI}}{Run the example with {\itshape STM32 Nucleo} board and {\itshape Unicleo GUI}}}\label{index_autotoc_md26}


{\bfseries{Click to see/hide details }}\begin{adjustwidth}{1em}{0em}


\href{https://www.st.com/content/st_com/en/products/embedded-software/evaluation-tool-software/unicleo-gui.html}{\texttt{ Unicleo GUI}} software tool works with \href{https://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/mcu-mpu-eval-tools/stm32-mcu-mpu-eval-tools/stm32-nucleo-boards.html}{\texttt{ STM32 Nucleo}} motherboards coupled with X-\/\+NUCLEO expansion boards (e.\+g. \href{https://www.st.com/content/st_com/en/products/ecosystems/stm32-open-development-environment/stm32-nucleo-expansion-boards/stm32-ode-sense-hw/x-nucleo-iks01a3.html}{\texttt{ X-\/\+NUCLEO-\/\+IKS01\+A3}}). Optional sensor in form of DIL24 adapter can be plugged on top of the X-\/\+NUCLEO expansion board.

To run the MLC application example in {\itshape Unicleo GUI}, the {\ttfamily .ucf} file has to be loaded. Here are all the required steps\+:


\begin{DoxyEnumerate}
\item Download the latest version of {\itshape Unicleo GUI} (if not already installed on your PC)
\item Download the latest version of \href{https://www.st.com/content/st_com/en/products/embedded-software/mcu-mpu-embedded-software/stm32-embedded-software/stm32cube-expansion-packages/x-cube-mems1.html}{\texttt{ X-\/\+CUBE-\/\+MEMS1}}
\item Plug X-\/\+NUCLEO expansion board (e.\+g. MEMS expansion board {\itshape X-\/\+NUCLEO-\/\+IKS01\+A3} to {\itshape STM32 Nucleo} board
\item Optionally plug the DIL24 adapter with MLC feature (e.\+g. \href{https://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/mems-motion-sensor-eval-boards/steval-mki197v1.html}{\texttt{ STEVAL-\/\+MKI197\+V1}}, depending on the example) to the DIL24 socket on X-\/\+NUCLEO expansion board
\item Plug the {\itshape STM32 Nucleo} board to your PC through a USB-\/mini\+USB cable
\item {\itshape STM32 Nucleo} has to be programmed with {\bfseries{Data\+Log\+Extended}} firmware from X-\/\+CUBE-\/\+MEMS1 package (if already programmed you can skip the following two steps)
\begin{DoxyItemize}
\item Locate {\itshape Datalog\+Extended.\+bin} file in X-\/\+CUBE-\/\+MEMS1 package (\texorpdfstring{$\ast$}{*}\+STM32\+Cube\+Expansion\+\_\+\+MEMS1\+\_\+\+Vx.x.\+x\textbackslash{}\+Projects\textbackslash{}\+STM32xxxxxx-\/Nucleo\textbackslash{}\+Examples\textbackslash{}\+IKS0xxxx\textbackslash{}\+Data\+Log\+Extended\texorpdfstring{$\ast$}{*})
\item Copy the {\itshape Datalog\+Extended.\+bin} file to the disk drive associated with the STM32 Nucleo board
\end{DoxyItemize}
\item Run {\itshape Unicleo GUI}, connect to the device, select the desired sensors, click the checkbox to enable the MLC, then click on the MLC button on the left panel, browse and load the {\itshape Unico GUI} Configuration File ({\ttfamily .ucf}) through the {\itshape Browse} button, finally click the Start button in the main window
\item MLC results are displayed in the {\itshape MLC} window and User Messages Tab
\end{DoxyEnumerate}

\end{adjustwidth}
\hypertarget{index_autotoc_md27}{}\doxysubsection{\texorpdfstring{Run the example with {\itshape Sensor\+Tile.\+box} and {\itshape Unicleo GUI}}{Run the example with {\itshape Sensor\+Tile.\+box} and {\itshape Unicleo GUI}}}\label{index_autotoc_md27}


{\bfseries{Click to see/hide details }}\begin{adjustwidth}{1em}{0em}


The {\ttfamily .ucf} file can also be loaded in the \href{https://www.st.com/en/evaluation-tools/steval-mksbox1v1.html}{\texttt{ Sensor\+Tile.\+box}} board through the {\bfseries{Data\+Log\+Extended}} firmware available in \href{https://www.st.com/content/st_com/en/products/embedded-software/mcu-mpu-embedded-software/stm32-embedded-software/stm32-ode-function-pack-sw/fp-sns-stbox1.html}{\texttt{ FP-\/\+SNS-\/\+STBOX1}} package. The Sensor\+Tile.\+box can be programmed by \href{https://www.st.com/content/st_com/en/products/development-tools/software-development-tools/stm32-software-development-tools/stm32-programmers/stm32cubeprog.html\#overview}{\texttt{ STM32\+Cube\+Programmer}} software. Here all the steps\+:


\begin{DoxyEnumerate}
\item Download the latest version of \href{https://www.st.com/en/embedded-software/unicleo-gui.html}{\texttt{ Unicleo GUI}} (if not already installed on your PC)
\item Download the latest version of {\itshape FP-\/\+SNS-\/\+STBOX1}
\item Sensor\+Tile.\+box has to be programmed with {\bfseries{Data\+Log\+Extended}} firmware from FP-\/\+SNS-\/\+STBOX1 package (if already programmed you can skip the following two steps)
\begin{DoxyItemize}
\item Put the Sensor\+Tile.\+box in {\bfseries{DFU mode}} (Direct Firmware Upgrade)\+: disconnect the battery and unplug the USB cable, press and hold the "{}\+DFU boot"{} button, connect the USB cable then release the button while connecting the USB cable.
\item Run STM32\+Cube\+Programmer, select "{}\+USB"{} from the pull-\/down menu on the right, then press "{}\+Connect"{}. Click on the Menu button in the top-\/left corner. Optionally perform a full chip erase. Select "{}\+Erase \& Programming"{}, browse to select the {\bfseries{Data\+Log\+Extended}} binary, set the address to 0x8000000, check "{}\+Run after Programming"{}, then click "{}\+Start Programming"{}.
\end{DoxyItemize}
\item Run {\itshape Unicleo GUI}, connect to the device, select the desired sensors, click the checkbox to enable the MLC, then click on the MLC button on the left panel, browse and load the {\itshape Unico GUI} Configuration File ({\ttfamily .ucf}) through the {\itshape Browse} button, finally click the Start button in the main window
\item MLC results are displayed in MLC window and User Messages Tab
\end{DoxyEnumerate}

\end{adjustwidth}
\hypertarget{index_autotoc_md28}{}\doxysubsection{\texorpdfstring{Run the example with {\itshape Sensor\+Tile.\+box} and {\itshape Algo\+Builder}}{Run the example with {\itshape Sensor\+Tile.\+box} and {\itshape Algo\+Builder}}}\label{index_autotoc_md28}


{\bfseries{Click to see/hide details }}\begin{adjustwidth}{1em}{0em}


\href{https://www.st.com/content/st_com/en/products/embedded-software/mems-and-sensors-software/inemo-engine-software-libraries/algobuilder.html}{\texttt{ Algo\+Builder}} is a software tool able to design a custom processing flow and to build the firmware for \href{https://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/mcu-mpu-eval-tools/stm32-mcu-mpu-eval-tools/stm32-nucleo-boards.html}{\texttt{ STM32 Nucleo}} boards coupled with the MEMS expansions, or for form-\/factor evaluation boards such as \href{https://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/mems-motion-sensor-eval-boards/steval-mksbox1v1.html}{\texttt{ Sensor\+Tile.\+box}}.

You will create a firmware project using {\itshape Algo\+Builder}, which can be configured to use \href{https://www.st.com/content/st_com/en/products/development-tools/software-development-tools/stm32-software-development-tools/stm32-ides/stm32cubeide.html}{\texttt{ STM32\+Cube\+IDE}} to generate the binary file, \href{https://www.st.com/content/st_com/en/products/development-tools/software-development-tools/stm32-software-development-tools/stm32-programmers/stm32cubeprog.html\#overview}{\texttt{ STM32\+Cube\+Programmer}} to program the Sensor\+Tile.\+box device, and \href{https://www.st.com/content/st_com/en/products/embedded-software/evaluation-tool-software/unicleo-gui.html}{\texttt{ Unicleo GUI}} to display the output in real-\/time.


\begin{DoxyEnumerate}
\item Configure {\itshape Algo\+Builder}\+: "{}\+File"{} -\/\texorpdfstring{$>$}{>} "{}\+Application Settings"{}, browse to select the path for Unicleo GUI, STM32\+Cube\+IDE, and STM32\+Cube\+Programmer.
\item Create a new design\+: "{}\+File"{} -\/\texorpdfstring{$>$}{>} "{}\+New Design"{}, browse and select the directory for the project, select the available IDE toolchain, select "{}\+Sensor\+Tile.\+box"{} or "{}\+Sensor\+Tile.\+box BLE"{} as target platform (the latter will support the use of a Bluetooth connection instead of the USB cable).
\item Click and configure the default "{}\+Sensor Hub"{} block in the design to \uline{use the timer as data rate control}, set the data rate and the full-\/scale of the sensors according to the example to be loaded. These settings should match the MLC settings.
\item Expand the "{}\+Sensor Hub"{} library, drag and drop the "{}\+FSM / MLC"{} block in the design, connect it to the "{}\+Sensor Hub"{} block, click and configure it for 0 Finite State Machine, 1 Decision Tree in the Machine Learning core, browse and select the corresponding {\ttfamily .ucf} file.
\item Optionally, from the "{}\+Sensor Hub"{} library, drag and drop the "{}\+Acceleration"{} block, connect it to the "{}\+Sensor Hub"{} block. Then, from the "{}\+Display"{} library, drag and drop the "{}\+Graph"{} block, click and configure it for the accelerometer data type, then connect it to the Acceleration block.
\item Then, from the "{}\+Display"{} library, drag and drop the "{}\+Value"{} block, click and configure it for the custom data type, set Number of Values to 1, set Window, Value, Unit names and then connect it to the MLC output from FSM / MLC function block.
\item Generate the project\+: "{}\+Firmware"{} -\/\texorpdfstring{$>$}{>} "{}\+Generate C code"{}. Then build the binary\+: "{}\+Firmware"{} -\/\texorpdfstring{$>$}{>} "{}\+Build Firmware"{}.
\item Program the target\+: put the {\itshape Sensor\+Tile.\+box} in {\bfseries{DFU mode}}, "{}\+Tools"{} -\/\texorpdfstring{$>$}{>} "{}\+Program Target"{}.
\item Open {\itshape Unicleo GUI}\+: "{}\+Tools"{} -\/\texorpdfstring{$>$}{>} "{}\+Run Unicleo-\/\+GUI application"{}, connect to the device, press Start to display the output in real-\/time.
\end{DoxyEnumerate}

\end{adjustwidth}
\hypertarget{index_autotoc_md29}{}\doxysubsection{\texorpdfstring{Run the example with {\itshape STWIN} and {\itshape HSDatalog}}{Run the example with {\itshape STWIN} and {\itshape HSDatalog}}}\label{index_autotoc_md29}


{\bfseries{Click to see/hide details }}\begin{adjustwidth}{1em}{0em}


\href{https://www.st.com/content/st_com/en/products/embedded-software/mcu-mpu-embedded-software/stm32-embedded-software/stm32-ode-function-pack-sw/fp-sns-datalog1.html}{\texttt{ HSDatalog}} is a high speed data logging command line application for the \href{https://www.st.com/en/evaluation-tools/steval-stwinkt1.html}{\texttt{ STWIN}} board.

{\itshape HSDatalog} also allows configuring ISM330\+DHCX Machine learning Core and reading the output of the selected algorithm.

Here all the required steps to run a MLC example through {\itshape STWIN} and {\itshape HSDatalog}\+:


\begin{DoxyEnumerate}
\item Download the latest version of {\itshape HSDatalog}, contained in \href{https://www.st.com/content/st_com/en/products/embedded-software/mcu-mpu-embedded-software/stm32-embedded-software/stm32-ode-function-pack-sw/fp-sns-datalog1.html}{\texttt{ FP-\/\+SNS-\/\+DATALOG1}} ( STM32\+Cube High Speed Datalog function pack for STWIN evaluation kits )
\item STWIN has to be programmed with {\bfseries{HSDatalog}} firmware from {\itshape FP-\/\+SNS-\/\+DATALOG1} package (if already programmed you can skip the following two steps)
\begin{DoxyItemize}
\item Put the {\itshape STWIN} in {\bfseries{DFU mode}} (Direct Firmware Upgrade)\+: disconnect the battery and unplug the USB cable, press and hold the "{}\+USR"{} button, connect the USB cable then release the button while connecting the USB cable.
\item Run \href{https://www.st.com/content/st_com/en/products/development-tools/software-development-tools/stm32-software-development-tools/stm32-programmers/stm32cubeprog.html\#overview}{\texttt{ STM32\+Cube\+Programmer}}, select "{}\+USB"{} from the pull-\/down menu on the right, then press "{}\+Connect"{}. Click on the Menu button in the top-\/left corner. Optionally perform a full chip erase. Select "{}\+Erase \& Programming"{}, browse to select the {\bfseries{HSDatalog}} binary (e.\+g. \textbackslash{}\+FP-\/\+SNS-\/\+DATALOG1\+\_\+\+V1.\+0.\+0\textbackslash{}\+Projects\textbackslash{}\+HSDatalog\textbackslash{}\+Binary\textbackslash{}\+HSDatalog.bin), set the address to 0x8000000, check "{}\+Run after Programming"{}, then click "{}\+Start Programming"{}.
\end{DoxyItemize}
\item Load the {\ttfamily .ucf} configuration to ISM330\+DHCX on {\itshape STWIN}, and acquire data logs to see MLC outputs. To do this, a terminal has to be opened, and the "{}cli\+\_\+example"{} application (contained in \textbackslash{}\+FP-\/\+SNS-\/\+DATALOG1\+\_\+\+V1.\+0.\+0\textbackslash{}\+Utilities\textbackslash{}cli\+\_\+example\textbackslash{}bin) has to be called specifying the .ucf file name and (optionally) the period of the acquisition\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{cli\_example.exe\ -\/u\ file\_name.ucf\ -\/t\ n\_sec}

\end{DoxyCode}


Further details on the high-\/speed data log function pack are available in the user manual \href{https://www.st.com/resource/en/user_manual/dm00685314-getting-started-with-the-stm32cube-high-speed-datalog-function-pack-for-stwin-evaluation-kits-stmicroelectronics.pdf}{\texttt{ UM2688}}.
\end{DoxyEnumerate}

\end{adjustwidth}
\hypertarget{index_autotoc_md30}{}\doxysubsection{\texorpdfstring{Run the example on a custom hardware using {\itshape C-\/programming}}{Run the example on a custom hardware using {\itshape C-\/programming}}}\label{index_autotoc_md30}


{\bfseries{Click to see/hide details }}\begin{adjustwidth}{1em}{0em}


A {\ttfamily .h} file is provided to easily include the MLC configuration in any C-\/programmable custom hardware. ~\newline


For using the {\itshape C header} files ({\ttfamily .h}), it is required\+:


\begin{DoxyItemize}
\item A standard C language compiler for the target MCU
\item A C library for the target MCU and the desired interface (i.\+e. SPI, I2C)
\end{DoxyItemize}

To run the example through the configuration provided in the {\ttfamily .h} file, it necessary to\+:


\begin{DoxyEnumerate}
\item Include the C header file ({\ttfamily .h}) in the desired project
\item Use the desired interface C library for the target {\itshape MCU} for writing the configuration registers array contained in the {\itshape C header} file ({\ttfamily .h}).
\end{DoxyEnumerate}

Some examples of sensors integration are available at the \href{http://www.st.com/content/st_com/en/products/embedded-software/mems-and-sensors-software/drivers-for-mems/c-driver-mems.html}{\texttt{ platform independent drivers repository}} for {\itshape STMicroelectronics} sensors.

\end{adjustwidth}


\DoxyHorRuler{0}


\DoxyHorRuler{0}


{\bfseries{More Information\+: \href{http://st.com/MEMS}{\texttt{ http\+://www.\+st.\+com}}}}

{\bfseries{Copyright © 2020 STMicroelectronics}} 